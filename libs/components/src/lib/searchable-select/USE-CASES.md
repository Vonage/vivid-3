## Country Select

```html preview 550px
<vwc-searchable-select label="Countries" clearable multiple>
	<vwc-icon slot="icon" name="globe-line"></vwc-icon>
	<vwc-option
		icon="flag-afghanistan"
		value="afghanistan"
		text="Afghanistan"
	></vwc-option>
	<vwc-option icon="flag-albania" value="albania" text="Albania"></vwc-option>
	<vwc-option icon="flag-algeria" value="algeria" text="Algeria"></vwc-option>
	<vwc-option
		icon="flag-argentina"
		value="argentina"
		text="Argentina"
	></vwc-option>
	<vwc-option icon="flag-armenia" value="armenia" text="Armenia"></vwc-option>
	<vwc-option icon="flag-aruba" value="aruba" text="Aruba"></vwc-option>
	<vwc-option
		icon="flag-australia"
		value="australia"
		text="Australia"
	></vwc-option>
	<vwc-option icon="flag-austria" value="austria" text="Austria"></vwc-option>
	<vwc-option icon="flag-bahamas" value="bahamas" text="Bahamas"></vwc-option>
	<vwc-option icon="flag-bahrain" value="bahrain" text="Bahrain"></vwc-option>
	<vwc-option icon="flag-belarus" value="belarus" text="Belarus"></vwc-option>
	<vwc-option icon="flag-belgium" value="belgium" text="Belgium"></vwc-option>
	<vwc-option icon="flag-benin" value="benin" text="Benin"></vwc-option>
	<vwc-option icon="flag-bolivia" value="bolivia" text="Bolivia"></vwc-option>
	<vwc-option
		icon="flag-botswana"
		value="botswana"
		text="Botswana"
	></vwc-option>
	<vwc-option icon="flag-brazil" value="brazil" text="Brazil"></vwc-option>
	<vwc-option
		icon="flag-bulgaria"
		value="bulgaria"
		text="Bulgaria"
	></vwc-option>
	<vwc-option
		icon="flag-burkina-faso"
		value="burkina-faso"
		text="Burkina Faso"
	></vwc-option>
	<vwc-option
		icon="flag-cambodia"
		value="cambodia"
		text="Cambodia"
	></vwc-option>
	<vwc-option icon="flag-canada" value="canada" text="Canada"></vwc-option>
	<vwc-option
		icon="flag-cayman-islands"
		value="cayman-islands"
		text="Cayman Islands"
	></vwc-option>
	<vwc-option
		icon="flag-central-african-republic"
		value="central-african-republic"
		text="Central African Republic"
	></vwc-option>
	<vwc-option icon="flag-chad" value="chad" text="Chad"></vwc-option>
	<vwc-option icon="flag-chile" value="chile" text="Chile"></vwc-option>
	<vwc-option icon="flag-china" value="china" text="China"></vwc-option>
	<vwc-option
		icon="flag-colombia"
		value="colombia"
		text="Colombia"
	></vwc-option>
	<vwc-option
		icon="flag-costa-rica"
		value="costa-rica"
		text="Costa Rica"
	></vwc-option>
	<vwc-option icon="flag-croatia" value="croatia" text="Croatia"></vwc-option>
	<vwc-option icon="flag-cyprus" value="cyprus" text="Cyprus"></vwc-option>
	<vwc-option icon="flag-denmark" value="denmark" text="Denmark"></vwc-option>
	<vwc-option
		icon="flag-dominican-republic"
		value="dominican-republic"
		text="Dominican Republic"
	></vwc-option>
	<vwc-option icon="flag-egypt" value="egypt" text="Egypt"></vwc-option>
	<vwc-option
		icon="flag-el-salvador"
		value="el-salvador"
		text="El Salvador"
	></vwc-option>
	<vwc-option icon="flag-estonia" value="estonia" text="Estonia"></vwc-option>
	<vwc-option
		icon="flag-european-union"
		value="european-union"
		text="European Union"
	></vwc-option>
	<vwc-option icon="flag-finland" value="finland" text="Finland"></vwc-option>
	<vwc-option icon="flag-france" value="france" text="France"></vwc-option>
	<vwc-option icon="flag-georgia" value="georgia" text="Georgia"></vwc-option>
	<vwc-option icon="flag-germany" value="germany" text="Germany"></vwc-option>
	<vwc-option icon="flag-ghana" value="ghana" text="Ghana"></vwc-option>
	<vwc-option icon="flag-grenada" value="grenada" text="Grenada"></vwc-option>
	<vwc-option
		icon="flag-guatemala"
		value="guatemala"
		text="Guatemala"
	></vwc-option>
	<vwc-option
		icon="flag-honduras"
		value="honduras"
		text="Honduras"
	></vwc-option>
	<vwc-option
		icon="flag-hong-kong"
		value="hong-kong"
		text="Hong Kong"
	></vwc-option>
	<vwc-option icon="flag-hungary" value="hungary" text="Hungary"></vwc-option>
	<vwc-option icon="flag-iceland" value="iceland" text="Iceland"></vwc-option>
	<vwc-option icon="flag-india" value="india" text="India"></vwc-option>
	<vwc-option
		icon="flag-indonesia"
		value="indonesia"
		text="Indonesia"
	></vwc-option>
	<vwc-option icon="flag-ireland" value="ireland" text="Ireland"></vwc-option>
	<vwc-option icon="flag-israel" value="israel" text="Israel"></vwc-option>
	<vwc-option icon="flag-italy" value="italy" text="Italy"></vwc-option>
	<vwc-option icon="flag-jamaica" value="jamaica" text="Jamaica"></vwc-option>
	<vwc-option icon="flag-japan" value="japan" text="Japan"></vwc-option>
	<vwc-option icon="flag-latvia" value="latvia" text="Latvia"></vwc-option>
	<vwc-option
		icon="flag-liechtenstein"
		value="liechtenstein"
		text="Liechtenstein"
	></vwc-option>
	<vwc-option
		icon="flag-lithuania"
		value="lithuania"
		text="Lithuania"
	></vwc-option>
	<vwc-option
		icon="flag-luxembourg"
		value="luxembourg"
		text="Luxembourg"
	></vwc-option>
	<vwc-option icon="flag-macao" value="macao" text="Macao"></vwc-option>
	<vwc-option
		icon="flag-malaysia"
		value="malaysia"
		text="Malaysia"
	></vwc-option>
	<vwc-option icon="flag-malta" value="malta" text="Malta"></vwc-option>
	<vwc-option
		icon="flag-mauritius"
		value="mauritius"
		text="Mauritius"
	></vwc-option>
	<vwc-option icon="flag-mexico" value="mexico" text="Mexico"></vwc-option>
	<vwc-option icon="flag-moldova" value="moldova" text="Moldova"></vwc-option>
	<vwc-option
		icon="flag-netherlands"
		value="netherlands"
		text="Netherlands"
	></vwc-option>
	<vwc-option
		icon="flag-new-zealand"
		value="new-zealand"
		text="New Zealand"
	></vwc-option>
	<vwc-option icon="flag-nigeria" value="nigeria" text="Nigeria"></vwc-option>
	<vwc-option icon="flag-norway" value="norway" text="Norway"></vwc-option>
	<vwc-option
		icon="flag-pakistan"
		value="pakistan"
		text="Pakistan"
	></vwc-option>
	<vwc-option icon="flag-panama" value="panama" text="Panama"></vwc-option>
	<vwc-option icon="flag-peru" value="peru" text="Peru"></vwc-option>
	<vwc-option
		icon="flag-philippines"
		value="philippines"
		text="Philippines"
	></vwc-option>
	<vwc-option icon="flag-poland" value="poland" text="Poland"></vwc-option>
	<vwc-option
		icon="flag-portugal"
		value="portugal"
		text="Portugal"
	></vwc-option>
	<vwc-option
		icon="flag-puertorico"
		value="puertorico"
		text="Puerto Rico"
	></vwc-option>
	<vwc-option icon="flag-romania" value="romania" text="Romania"></vwc-option>
	<vwc-option icon="flag-russia" value="russia" text="Russia"></vwc-option>
	<vwc-option icon="flag-rwanda" value="rwanda" text="Rwanda"></vwc-option>
	<vwc-option
		icon="flag-saudi-arabia"
		value="saudi-arabia"
		text="Saudi Arabia"
	></vwc-option>
	<vwc-option icon="flag-serbia" value="serbia" text="Serbia"></vwc-option>
	<vwc-option
		icon="flag-singapore"
		value="singapore"
		text="Singapore"
	></vwc-option>
	<vwc-option
		icon="flag-slovakia"
		value="slovakia"
		text="Slovakia"
	></vwc-option>
	<vwc-option
		icon="flag-slovenia"
		value="slovenia"
		text="Slovenia"
	></vwc-option>
	<vwc-option
		icon="flag-south-africa"
		value="south-africa"
		text="South Africa"
	></vwc-option>
	<vwc-option
		icon="flag-south-korea"
		value="south-korea"
		text="South Korea"
	></vwc-option>
	<vwc-option icon="flag-spain" value="spain" text="Spain"></vwc-option>
	<vwc-option
		icon="flag-sri-lanka"
		value="sri-lanka"
		text="Sri Lanka"
	></vwc-option>
	<vwc-option icon="flag-sweden" value="sweden" text="Sweden"></vwc-option>
	<vwc-option
		icon="flag-switzerland"
		value="switzerland"
		text="Switzerland"
	></vwc-option>
	<vwc-option icon="flag-taiwan" value="taiwan" text="Taiwan"></vwc-option>
	<vwc-option
		icon="flag-tajikistan"
		value="tajikistan"
		text="Tajikistan"
	></vwc-option>
	<vwc-option
		icon="flag-tanzania"
		value="tanzania"
		text="Tanzania"
	></vwc-option>
	<vwc-option
		icon="flag-thailand"
		value="thailand"
		text="Thailand"
	></vwc-option>
	<vwc-option
		icon="flag-trinidad-and-tobago"
		value="trinidad-and-tobago"
		text="Trinidad and Tobago"
	></vwc-option>
	<vwc-option icon="flag-turkey" value="turkey" text="Turkey"></vwc-option>
	<vwc-option icon="flag-ukraine" value="ukraine" text="Ukraine"></vwc-option>
	<vwc-option
		icon="flag-united-arab-emirates"
		value="united-arab-emirates"
		text="United Arab Emirates"
	></vwc-option>
	<vwc-option
		icon="flag-united-kingdom"
		value="united-kingdom"
		text="United Kingdom"
	></vwc-option>
	<vwc-option
		icon="flag-united-states"
		value="united-states"
		text="United States"
	></vwc-option>
	<vwc-option icon="flag-uruguay" value="uruguay" text="Uruguay"></vwc-option>
	<vwc-option
		icon="flag-uzbekistan"
		value="uzbekistan"
		text="Uzbekistan"
	></vwc-option>
	<vwc-option
		icon="flag-venezuela"
		value="venezuela"
		text="Venezuela"
	></vwc-option>
	<vwc-option icon="flag-vietnam" value="vietnam" text="Vietnam"></vwc-option>
	<vwc-option icon="flag-zambia" value="zambia" text="Zambia"></vwc-option>
</vwc-searchable-select>

<style>
	vwc-searchable-select {
		width: 400px;
	}
</style>
```

## In a Form

```html preview 250px
<style>
	.buttons {
		display: flex;
		gap: 12px;
	}
</style>
<form>
	<vwc-layout column-spacing="small" column-basis="block">
		<div>
			<vwc-searchable-select name="country" multiple required>
				<vwc-option
					icon="flag-afghanistan"
					value="AF"
					text="Afghanistan"
				></vwc-option>
				<vwc-option icon="flag-albania" value="AL" text="Albania"></vwc-option>
				<vwc-option icon="flag-algeria" value="DZ" text="Algeria"></vwc-option>
			</vwc-searchable-select>
		</div>
		<div class="buttons">
			<vwc-button label="Reset" type="reset"></vwc-button>
			<vwc-button label="Submit" appearance="filled" type="submit"></vwc-button>
		</div>
	</vwc-layout>
</form>
```

## Asynchronous Option Loading

To fetch options for the search text asynchronously you will need combine several features:

Use `searchText` and the `search-text-change` event to fetch options for the search text. Set `loading` while options are being fetched.

Use the `no-options` slot to indicate that options will become available when the user starts typing.

As you are now handling the filtering of options yourself, you need to disable the built-in filtering logic:

- Set `optionFilter` to always return `true` to show all options.
- Set `matchedText` on the options to the search text they were fetched with.

Already selected options need to stay present, even if they are no longer in the current result set. Use `hidden` to hide them in the dropdown.

```html preview 500px
<vwc-searchable-select label="Favorite fruit">
	<span slot="no-options">Start typing to search...</span>
</vwc-searchable-select>

<vwc-searchable-select label="Favorite fruits" multiple>
	<span slot="no-options">Start typing to search...</span>
</vwc-searchable-select>

<script>
	const fruitsDatabase = [
		'Apple',
		'Banana',
		'Cherry',
		'Date',
		'Elderberry',
		'Fig',
		'Grape',
		'Jackfruit',
		'Kiwi',
		'Lemon',
		'Mango',
		'Nectarine',
		'Orange',
		'Passion fruit',
		'Quince',
		'Raspberry',
		'Strawberry',
		'Watermelon',
	];

	async function fetchOptions(searchText) {
		return new Promise((resolve) => {
			setTimeout(
				() =>
					resolve(
						fruitsDatabase
							.filter((fruit) =>
								fruit.toLowerCase().includes(searchText.toLowerCase())
							)
							.map((fruit) => ({
								value: fruit,
								text: fruit,
							}))
					),
				1000
			);
		});
	}

	window.customElements.whenDefined('vwc-searchable-select').then(() => {
		document.querySelectorAll('vwc-searchable-select').forEach((select) => {
			// Disable built-in filtering
			select.optionFilter = () => true;

			// State
			let componentState = {
				selectedOptions: [],
				currentSearchResults: [],
				currentSearchText: '',
			};

			function MyComponent(state) {
				const retainedOptions = state.selectedOptions.filter(
					(s) => !state.currentSearchResults.some((o) => o.value === s.value)
				);
				return [
					// Render options that are selected but no longer in the current search results
					...retainedOptions.map((option) => {
						return {
							key: option.value,
							props: {
								value: option.value,
								text: option.text,
								matchedText: '',
								hidden: true, // But hide them from the dropdown
							},
						};
					}),
					...state.currentSearchResults.map((option) => {
						return {
							key: option.value,
							props: {
								value: option.value,
								text: option.text,
								matchedText: state.currentQueryText, // Use the search text that the search was performed with
								hidden: false,
							},
						};
					}),
				];
			}

			let previousRenderedOptions = [];
			const updateState = (newState) => {
				componentState = newState;
				const newRenderedOptions = MyComponent(componentState);
				updateDOM(select, previousRenderedOptions, newRenderedOptions);
				previousRenderedOptions = newRenderedOptions;
			};

			let latestSearchText = '';
			const debouncedSearch = debounce(async (searchText) => {
				const newResults = await fetchOptions(searchText);
				if (latestSearchText !== searchText) {
					return; // Results are no longer relevant
				}
				select.loading = false;
				updateState({
					...componentState,
					currentSearchResults: newResults,
					currentQueryText: searchText,
				});
			}, 1000);

			const onSearchTextChanged = (newSearchText) => {
				if (newSearchText === '') {
					latestSearchText = '';
					select.loading = false;
					updateState({
						...componentState,
						currentSearchResults: [],
						currentQueryText: '',
					});
				} else {
					latestSearchText = newSearchText;
					select.loading = true;
					debouncedSearch(newSearchText);
				}
			};

			select.addEventListener('search-text-change', (e) => {
				onSearchTextChanged(e.currentTarget.searchText);
			});

			select.addEventListener('input', (e) => {
				updateState({
					...componentState,
					selectedOptions: e.currentTarget.values.map(
						(v) =>
							componentState.currentSearchResults.find((o) => o.value === v) ||
							componentState.selectedOptions.find((o) => o.value === v)
					),
				});
			});
		});
	});

	function debounce(func, timeout) {
		let timer;
		return (...args) => {
			clearTimeout(timer);
			timer = setTimeout(() => {
				func.apply(this, args);
			}, timeout);
		};
	}

	function updateDOM(select, oldRenderedOptions, newRenderedOptions) {
		const insertAfter = (afterEl, el) => {
			if (afterEl) {
				afterEl.after(el);
			} else {
				select.appendChild(el);
			}
		};

		let lastEl = null;
		for (let i = 0; i < newRenderedOptions.length; i++) {
			const newNode = newRenderedOptions[i];
			const oldNode = oldRenderedOptions.find((o) => o.key === newNode.key);
			const el =
				select.querySelector(`[data-key="${newNode.key}"]`) ||
				document.createElement('vwc-option');
			el.dataset.key = newNode.key;
			for (const key of Object.keys(newNode.props)) {
				if (!oldNode || newNode.props[key] !== oldNode.props[key]) {
					el[key] = newNode.props[key];
				}
			}
			insertAfter(lastEl, el);
			lastEl = el;
		}
		for (const oldNode of oldRenderedOptions) {
			if (!newRenderedOptions.find((n) => n.key === oldNode.key)) {
				select.querySelector(`[data-key="${oldNode.key}"]`).remove();
			}
		}
	}
</script>
```
